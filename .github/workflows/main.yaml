name: Build and Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  NAPPHP_VERSION: v0.0.17
  NAPPHP_LOAD_PATH: /home/runner/napphp/src/__loadAsClass.php

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Install Dependencies
      run: |
         sudo apt-get update
         sudo apt install gcc make
         sudo apt install valgrind
         sudo apt install fakeroot-ng

    - name: Install napphp
      run: |
         mkdir ~/napphp
         git clone --depth 1 --branch $NAPPHP_VERSION 'https://github.com/nap-software/napphp.git' ~/napphp

    - name: Run CI-Script
      run: ./ci/run.php
